define([],function(){return function(e,t){var n="createTouch"in document||"ontouchstart"in e,r=document.createElement("div").style,i=function(){var e={OTransform:["-o-"],WebkitTransform:["-webkit-"],MozTransform:["-moz-"],msTransform:["-ms-"],transform:[""]},t;for(t in e)if(t in r)return e[t];return!1}(),s={h:["Width","left","right"],v:["Height","top","bottom"]},o=i&&i[0],u=function(e){return(e+"").replace(/^-ms-/,"ms-").replace(/-([a-z]|[0-9])/ig,function(e,t){return(t+"").toUpperCase()})},a=function(e){var t=u(o+e);return e in r&&e||t in r&&t},f=a("perspective"),l=a("transform"),c=function(e,t){for(var n in t)typeof e[n]=="undefined"&&(e[n]=t[n]);return e},h=function(e,t){var n=0,r=e.length;for(;n<r;n++)if(t.call(e[n],n,e[n])===!1)break},p=function(e){e=S.fn.eventHook(e),e.preventDefault()},d=n?"touchstart":"mousedown",v=n?"touchmove":"mousemove",m=n?"touchend":"mouseup",g=n?"touchstart":"mouseover",y=n?"touchend":"mouseout",b=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){return setTimeout(e,16)}}(),w=function(){return e.cancelRequestAnimationFrame||e.webkitCancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||clearTimeout}(),E=function(e,t){return e.contains?e!=t&&e.contains(t):!!(e.compareDocumentPosition(t)&16)},S=function(e,t){if(!(this instanceof S))return new S(e,t);typeof e!="string"&&!e.nodeType&&(t=e,e=t.id),e.nodeType||(e=document.getElementById(e)),this.cfg=c(t||{},this._default),this.container=e,this.container&&this.setup()};return S.fn=S.prototype={version:1.1,_default:{id:"slider",width:5,minLength:20,opacity:.8,color:"black",hScroll:"auto",vScroll:"auto",scrollBar:"auto",vOffset:0,hOffset:0,mouseWheel:!1,keyPress:!1,onRefresh:function(){}},css:function(e,t){if(typeof t=="string"){var n=document.defaultView&&document.defaultView.getComputedStyle&&getComputedStyle(e,null)||e.currentStyle||e.style||{};if(t!="opacity"||"opacity"in r)return n[u(t)];var i=n.filter;return i&&i.indexOf("opacity")>=0&&parseFloat(i.match(/opacity=([^)]*)/i)[1])/100+""||"1"}var s,o;for(s in t)o=t[s],s=="float"?s="cssFloat"in r?"cssFloat":"styleFloat":s!="opacity"||"opacity"in r?s=u(s):(s="filter",o="alpha(opacity="+parseFloat(o)*100+")"),e.style[s]=o;return this},addListener:function(e,t,n,r){return e.addEventListener?(e.addEventListener(t,n,r),!0):e.attachEvent?(e.attachEvent("on"+t,n),!0):!1},removeListener:function(e,t,n,r){return e.addEventListener?(e.removeEventListener(t,n,r),!0):e.attachEvent?(e.detachEvent("on"+t,n),!0):!1},eventHook:function(t){var r={},i="changedTouches touches scale target view type which char charCode key keyCode clientX clientY relatedTarget fromElement offsetX offsetY pageX pageY toElement".split(" ");t=t||e.event,h(i,function(){r[this]=t[this]}),r.target=t.target||t.srcElement||document,r.target.nodeType===3&&(r.target=r.target.parentNode),r.preventDefault=function(){t.preventDefault&&t.preventDefault(),r.returnValue=t.returnValue=!1};if(n&&r.touches)r.touches=r.touches.length?r.touches:r.changedTouches,r.pageX=r.touches.item(0).pageX,r.pageY=r.touches.item(0).pageY;else if(typeof t.pageX=="undefined"){var s=document.documentElement,o=document.body;r.pageX=t.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),r.pageY=t.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)}return r.origEvent=t,r},bind:function(e,t){return function(){return e.apply(t,arguments)}},pos:function(){var e={},t=this.hOffset,n=this.vOffset;return l?e[l]=f?"translate3d("+t+"px, "+n+"px, 0px)":"translate("+t+"px, "+n+"px)":(e.left=t+"px",e.top=n+"px"),this.css(this.element,e)},setup:function(){var t=this.css(this.container,"position"),r,i=this;h(["width","opacity","minLength","vOffset","hOffset"],function(e,t){i.cfg[t]=parseFloat(i.cfg[t])}),this.css(this.container,{overflow:"hidden",position:t=="static"?"relative":t}),this.element=document.createElement("div"),this.element.className="touchscroll",this.hOffset=-this.cfg.hOffset,this.vOffset=-this.cfg.vOffset,r={position:l?"":"relative",overflow:"hidden"},h(["Top","Right","Bottom","Left"],function(e,t){r["padding"+t]=i.css(i.container,"padding"+t),i.container.style["padding"+t]=0}),this.css(this.element,r);while(this.container.childNodes.length)this.element.appendChild(this.container.firstChild);r={position:"absolute",overflow:"hidden",borderRadius:Math.ceil(this.cfg.width/2)+"px",backgroundColor:this.cfg.color,opacity:0},a("boxSizing")&&(r[a("boxSizing")]="border-box"),a("backgroundClip")&&(r[a("backgroundClip")]="padding-box"),n&&(r["pointer-events"]="none"),this.hbar=document.createElement("div"),this.hbar.className="scrollbar hScrollBar",this.vbar=document.createElement("div"),this.vbar.className="scrollbar vScrollBar",this.comment=document.createComment("\n Powered by TouchScroll v"+this.version+",\n author: qiqiboy,\n email: imqiqiboy@gmail.com,\n blog: http://www.qiqiboy.com,\n weibo: http://weibo.com/qiqiboy\n"),this.container.appendChild(this.comment),this.container.appendChild(this.element),this.container.appendChild(this.hbar),this.container.appendChild(this.vbar),this.css(this.hbar,{bottom:"1px",height:this.cfg.width+"px"}).css(this.hbar,r),this.css(this.vbar,{right:"1px",width:this.cfg.width+"px"}).css(this.vbar,r),this.addListener(this.container,d,this._start=this.bind(this.start,this),!1),this.addListener(document,v,this._move=this.bind(this.move,this),!1),this.addListener(document,m,this._end=this.bind(this.end,this),!1),this.addListener(this.container,"touchcancel",this._end,!1),this.addListener(this.container,g,this._toggleShow=this.bind(this.toggleShow,this),!1),this.addListener(this.container,y,this._toggleShow,!1),this.cfg.mouseWheel&&(this.addListener(this.container,"mousewheel",this._mouseScroll=this.bind(this.mouseScroll,this),!1),this.addListener(this.container,"DOMMouseScroll",this._mouseScroll,!1)),this.cfg.keyPress&&this.addListener(document,"keydown",this._keypress=this.bind(this.keypress,this),!1),this.addListener(e,"resize",this._resize=this.bind(function(){clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(this.bind(this.resize,this),100)},this),!1),this.addListener(e,"orientationchange",this._resize,!1),this.fadeToggle().resize()},resize:function(){return this.stop().css(this.container,{visibility:"hidden"}).css(this.element,{width:"auto",height:"auto"}).resizeHandle("h").resizeHandle("v").css(this.container,{visibility:"visible"})},resizeHandle:function(e){var t=0,n=s[e][0],r=this.cfg[e+"Scroll"],i=n.toLowerCase(),o=this["inner"+n](this.element)-this.cfg[e+"Offset"],u=this["inner"+n](this.container);if(this.container["offset"+n]){this[e+"Scroll"]=!0,this[e+"bar"].style.display="block",u>o&&(t=u-o,o=u),this[i]=u,this["total"+n]=o,this.element.style[i]=t+this["get"+n](this.element)+"px";if(r===!1||r!==!0&&o==u)this[e+"bar"].style.display="none",this[e+"Scroll"]=!1;this[e+"FixLength"]=this["padding"+n](this[e+"bar"])+a("boxSizing")?0:this["border"+n](this[e+"bar"]),this.fixBounce(e)===!1&&this.refresh(e)}return this},toggleShow:function(e){e=this.eventHook(e);var t,r,i,s=e.type;s=="mouseover"?i=e.relatedTarget||e.fromElement:s=="mouseout"&&(i=e.relatedTarget||e.toElement),t=!i||i.prefix!="xul"&&!E(this.container,i)&&i!==this.container;if(n||t)s==g?this.mouseEnter=!0:this.mouseEnter=!1,this.fadeToggle();return this},fadeToggle:function(){var e=this,t=Math.round(this.css(this.hbar,"opacity")*10)/10||0,n=this.cfg.scrollBar===!1||this.cfg.scrollBar!==!0&&!this.during&&!this.mouseEnter?0:this.cfg.opacity,r=n-t,i=function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t},s=0,o=+(new Date),u,a=function(){s<600?(s=Math.min(600,+(new Date)-o),u=i(s,t,r,600),e.css(e.hbar,{opacity:u}),e.css(e.vbar,{opacity:u}),e.barTimer=b(a)):(e.css(e.hbar,{opacity:n}),e.css(e.vbar,{opacity:n}))};return w(e.barTimer),r&&a(),this},refresh:function(e){var t=this[e+"bar"],n=this["total"+s[e][0]],r=this[s[e][0].toLowerCase()],i=this[e+"Offset"],o=-this.cfg[e+"Offset"],u=Math.max(this.cfg.width,this.cfg.minLength),a=Math.max(parseFloat(r*r/n),u),f=n-r>0?(o-i)/(n-r)*(r-a)+"px":0,l="auto",c=i,h;return i>o?(f=0,h=i-o,a=Math.max(this.cfg.width,a-h/r*a),c=h/(h/r+1)+o):i<=r-n+o&&(f="auto",l=0,h=r-n+o-i,a=Math.max(this.cfg.width,a-h/r*a),c=r-n+o-h/(h/r+1)),t.style[s[e][1]]=f,t.style[s[e][2]]=l,t.style[s[e][0].toLowerCase()]=a-this[e+"FixLength"]+"px",this[e+"Offset"]=c,this.pos()},stop:function(){return w(this.hTimer),w(this.vTimer),clearTimeout(this.mouseTimer),this},scroll:function(e,t,n){var r=this,i=this.hOffset-e,s=this.vOffset-t;return this.stop(),this.mouseTimer=setTimeout(function(){r.fixBounce("v")},100),this.scrollTo(-i,-s,n)},scrollTo:function(e,t,n){var r=[-e,-t],i=["h","v"],s=0;for(;s<2;s++)this[i[s]+"Scroll"]&&!isNaN(r[s])&&this.slide(i[s],r[s],n);return this},slide:function(e,t,n){var r=this,i=this[s[e][2]],o=this[e+"Offset"],t,u,a=0,f=+(new Date),n=n==null?400:n,l=function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t},c=function(){a<n?(a=Math.min(n,+(new Date)-f),r[e+"Offset"]=l(a,o,u,n),r.refresh(e),r[e+"Timer"]=b(c)):(r[e+"Offset"]=t,r.fixBounce(e)===!1&&(r.during=!1,r.refresh(e),r.fadeToggle()))};return w(this[e+"Timer"]),this[e+"Offset"]=t,this.refresh(e),t=this[e+"Offset"],u=t-o,n&&(Math.abs(u)>=.5?(this.during=!0,c()):this.fixBounce(e)),this},start:function(e){e=this.eventHook(e);var t=e.target.nodeName.toLowerCase();!n&&(t=="a"||t=="img")&&e.preventDefault(),this.removeListener(this.element,"click",p),this.target=e.target,this.prevPos=[e.pageX,e.pageY]},move:function(t){if(!this.prevPos||t.scale&&t.scale!==1)return;t=this.eventHook(t);var n,r,i=[t.pageX,t.pageY];if(this.scrolling==null){n=Math.abs(i[0]-this.prevPos[0]),r=Math.abs(i[1]-this.prevPos[1]);if(n||r)this.scrolling=n<r?"v":"h",this[this.scrolling+"Scroll"]&&this.stop()}if(this.scrolling==null||!this[this.scrolling+"Scroll"])return;t.preventDefault();var o=this.scrolling,u,a=o==="h"?0:1,f=i[a]-this.prevPos[a],l=+(new Date),c;e.getSelection!=null&&(c=getSelection(),c.empty?c.empty():c.removeAllRanges&&c.removeAllRanges());if(this.target===this[o+"bar"]){var h=this["total"+s[o][0]],p=this[s[o][0].toLowerCase()];f*=(p-h)/(p-parseFloat(this.css(this.target,s[o][0].toLowerCase()))||1)}u=this[o+"Offset"]+=f,this.prevPos=i;if(!this.prevTime||l-this.prevTime>300)this.prevTime=l,this.prevOffset=this[o+"Offset"];this.refresh(o),this[o+"Offset"]=u,this.during=!0},end:function(e){if(this.prevPos){if(this.scrolling!=null&&this[this.scrolling+"Scroll"]){this.during=!1,this.addListener(this.element,"click",p);var t=this.scrolling,n,r;this.fixBounce(t)===!1&&this.target!=this.hbar&&this.target!=this.vbar&&(e=this.eventHook(e),n=+(new Date)-this.prevTime,r=this[t+"Offset"]-this.prevOffset,n&&n<300&&Math.abs(r)>20&&this.slide(t,this[t+"Offset"]+(3-n/300)*r,400)),this.fadeToggle()}delete this.target,delete this.prevPos,delete this.scrolling,delete this.prevTime}},fixBounce:function(e,t){var n=this["total"+s[e][0]],r=this[s[e][0].toLowerCase()],i=this[e+"Offset"],o=-this.cfg[e+"Offset"],u;if(i>o)u=o;else{if(!(i<r-n+o))return!1;u=r-n+o}return t=t==null?200:t,this.slide(e,u,t)},mouseScroll:function(e){e=this.eventHook(e);var t=e.origEvent,n=0,r;if("wheelDeltaX"in t)n=t.wheelDeltaX/4,r=t.wheelDeltaY/4;else if("wheelDelta"in t)r=t.wheelDelta/4,Math.abs(r)>9999&&(r=Math.abs(r)/r*30);else{if(!("detail"in t))return;r=-t.detail*9}e.preventDefault(),this.element&&r!==null&&this.scroll(-n,-r,0)},keypress:function(e){e=this.eventHook(e);var t=e.keyCode||e.which||e.charCode,n=0,r=0;switch(t){case 37:n=-120;break;case 38:r=-120;break;case 39:n=120;break;case 40:r=120;break;default:return}this.scroll(n,r,0)},destroy:function(){this.removeListener(this.container,d,this._start,!1),this.removeListener(document,v,this._move,!1),this.removeListener(document,m,this._end,!1),this.removeListener(this.container,"touchcancel",this._end,!1),this.removeListener(this.container,g,this._toggleShow,!1),this.removeListener(this.container,y,this._toggleShow,!1),this.cfg.mouseWheel&&(this.removeListener(this.container,"mousewheel",this._mouseScroll,!1),this.removeListener(this.container,"DOMMouseScroll",this._mouseScroll,!1)),this.cfg.keyPress&&this.removeListener(document,"keydown",this._keypress,!1),this.removeListener(e,"resize",this._resize,!1),this.removeListener(e,"orientationchange",this._resize,!1);while(this.element.childNodes.length)this.container.appendChild(this.element.firstChild);return this.container.removeChild(this.comment),this.container.removeChild(this.element),this.container.removeChild(this.hbar),this.container.removeChild(this.vbar),this.container.scrollLeft=-this.hOffset,this.container.scrollTop=-this.vOffset,this.css(this.container,{overflow:"",position:"",padding:"",visibility:""})}},h(["Width","Height"],function(e,t){var n=t.toLowerCase(),r=e===0?"h":"v";h(["margin","padding","border"],function(e,n){S.fn[n+t]=function(e){return(parseFloat(this.css(e,n+"-"+s[r][1]+(n=="border"?"-width":"")))||0)+(parseFloat(this.css(e,n+"-"+s[r][2]+(n=="border"?"-width":"")))||0)}}),S.fn["inner"+t]=function(e){return e["offset"+t]-this["border"+t](e)},S.fn["get"+t]=function(e){return e["offset"+t]-this["padding"+t](e)-this["border"+t](e)}}),S}(window)});